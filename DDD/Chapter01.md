---
tags:
  - study
  - architecture
  - domain
  - ddd
  - 유비쿼터스
  - 엔티티
aliases:
  - 도메인 아키텍처
---
# 도메인 모델 시작하기
## 도메인
### 도메인이란?
 - 개발자 입장에서 바라본 도메인이란 구현해야한 문제 영역이다. 
	 - 예시) 온라인 서점 소프트웨어는 상품조회, 구매, 결제, 배송 추적 등의 기능을 제공
	 - 여기서 온라인 서점 소프트웨어는 일종의 도메인(구현하고자하는 큰 문제 영역)
	 - 하위 도메인으론 상품, 구매, 결제, 배송 등의 온라인 서점 소프트웨어로 해결하고자 하는 기능
 - 한 도메인은 다시 하위 도메인으로 나눌 수 있음
 - 하위 도메인끼리 연동하여 완전한 기능을 제공하기도 한다.
	 - 주문, 결제, 배송의 기능이 엮여서 전체 주문완료로 이어짐
### 도메인 전문가와 개발자 간 지식 공유
- 도메인 전문가 : 정산, 배송 등 각 영역의 전문가(배송기사, 회계사 등등)
- 요구사항 == 첫단추 , 올바르게 이해하는 것이 중요
- 어떻게? 관계자의 도메인 지식 학습 및 직접 소통
- 'Garbage in, Garbage out' : '잘못된 값이 들어가면 잘못된 결과가 나온다.'
## **도메인 모델**
- 정의 : 도메인 모델은 특정 도메인을 개념적으로 표현한 것
- 표현 방식 : UML(클래스 다이어그램, 상태 다이어그램 등)
- 주의 사항
	- 각 하위 도메인이 다루는 영역이 서로 다르기 때문에 같은 용어라도 의미가 달리 질 수 있음
		- 카탈로그 도메인의 상품(정보)과 배송 도메인의 상품(물리적인 상품)은 상품이란 단어는 같으나 사용하는 의미가 다르다.
	- 여러 하위 도메인을 하나의 다이어그램으로 모델링 하면 안됨
	- 모델의 각 구성요소는 특정 도메인으로 한정할 때 비로소 의미가 완전해짐
### 도메인 모델 패턴
- 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴

| 영역             | 설명                            |
| -------------- | ----------------------------- |
| Presentation   | 사용자(또는 외부 시스템) 요청/응답 처리       |
| Application    | 사용자 요청 기능 실행                  |
| Domain         | 시스템이 제공할 도메인 규칙을 구현           |
| Infrastructure | DB나 messaging 과 같은 외부 시스템과 연동 |
- 개념 모델 : 순수하게 문제를 분석한 결과
- 구현 모델 : 개념을 구현한 모델 -> 구현하면서 도메인의 이해도가 높아지며 보완 및 변경이 발생
### 도메인 모델 도출
- 도메인 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾기
- 요구사항 분석
	- 어떤 기능이 필요한지
		- -> 출고상태변경하기, 주문취소하기, 결제 완료하기 등 기능
	- 어떤 데이터로 구성되어야 하는지 
		- -> 주문을 하기 위한 주문항목 같이 어떤 데이터가 필요한지
	- 데이터간의 관계는 어떻게 되는지 
		- -> 주문과 주문항목의 관계
	- 제약과 규칙은 어떤게 있는지 
		- -> 출고하면 배송지 변경 불가, 출고 전에만 주문 취소 가능과 같은 정책적인 부분
	- 상태는 어떤게 필요한지
		- -> 주문 상태 등과 같은 것
- 모델 공유를 위한 문서화
	- 지식공유
	- 코드 자체도 문서화의 대상
	- 도메인 관점에서 코드가 도메인을 잘 표현해야 비로소 코드의 가독성이 높아지고 문서로서 코드가 의미를 가짐
	- 
## 엔티티와 벨류
### 엔티티
- 식별자를 가짐 : 구분하기 위한 고유한 것
- 식별자는 변하지 않음
	- 식별자를 검증하기 위해 equals(), hashcode() 메서드를 구현한다
	- 식별자로 객체 동등성을 판단하기 위함이 그 이유이다.
### 엔티티의 식별자 생성
- 특정규칙
	- 현재 시간 + 다른 값 조합
	- 동일 시간에 생성해도 같은 식별자가 되어선 안됨
- 고유 식별자 생성기 (UUID, Nano ID)
- 직접 입력
	- 아이디/이메일 -> 중복 입력하지 않도록 사전에 방지
- 일련번호 사용
	- DB 제공하는 자동 증가 기능 이용
	- 그래서 db에 데이터를 추가하기 전에는 식별자를 알 수 없음
	- 
### 밸류
- 개념적으로 완전한 하나를 표현
- 명확하게 표현
- 밸류 타입을 위한 기능 축가 가능
- 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보단 변경한 데이터를 갖는 새로운 밸류 객첼 생성
- 불변(데이터 변경 기능을 제공하지 않는 상태) -> 안전한 코드
- 식별자와 밸류 -> 식별자를 밸류타입으로 가지고 가게되면 의미가 명확해진다
- 도메인 모델에 set 금지 이유
	- 필드값만 변경하고 끝나기 때문에 변경과 도메인 지식이 코드에서 사라짐
	- 도메인 객체를 생성할 때 온전하지 않은 상태기 될 수 있음
	- 그래서 생성자를 통해 필요한 데이터를 모두 받아야함
- 
## 유비쿼터스 언어
- 도메인과 관련된 관계자들간 공통의 언어
- 소통, 모호함 감소,  도메인과 코드 사이에서 불필요한 해석 감소
- 
