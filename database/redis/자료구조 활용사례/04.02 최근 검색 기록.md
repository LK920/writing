---
aliases:
  - 최근검색기록
tags:
  - 최근검색기록
  - sortedset
---
## Sorted Set을 이용한 최근 검색 기록

최근 검색 기록은 사용자가 최근에 검색한 내역을 확인할 수 있는 기능입니다.

### RDBMS 대신 Redis를 사용하는 이유

최근 검색 기록의 요구사항:
- 유저별로 독립적인 검색 기록 보유
- 중복 검색어 제거
- 최신 검색 순으로 N개만 표시

#### RDBMS의 한계
- 저장 → 최신 N개 조회 → N개만 남기기의 반복적인 작업 필요
- DB 접근이 빈번해짐 (읽기/쓰기 부하 증가)
- 검색 기록이 많아질수록 정렬 작업이 빈번해지고 관리할 테이블이 많아짐

#### Redis Sorted Set의 장점
- 저장 시점부터 중복 제거가 자동으로 처리됨
- Score로 시간을 사용하면 정렬이 자동으로 유지됨
- Key 명을 통해 유저를 식별할 수 있어 간단한 구조 유지
### 사용 방식

#### 1. 추가/업데이트
- Score를 시간 기반으로 사용 (타임스탬프 형식)
- Key에는 유저 ID를 포함
- Member는 검색어를 저장

**예시:**
```redis
# 유저 123이 2025년 11월 3일 11시 35분 01초에 "코듀로이" 검색
ZADD search:123 20251103113501 "코듀로이"

# 유저 123이 2025년 11월 4일 20시 21분 24초에 "코듀로이" 재검색
# → Score가 업데이트됨 (중복 제거 + 최신 시간으로 갱신)
ZADD search:123 20251104202124 "코듀로이"
```

#### 2. 조회
- 유저 ID만 알면 최신 검색 기록 조회 가능
- N개 조회 시 인덱스는 0부터 (N-1)까지 지정

**예시:**
```redis
# 유저 123의 최신 검색 기록 5개 조회
ZRANGE search:123 0 4 REV WITHSCORES
```

#### 3. 삭제 (오래된 검색어 삭제)
- 음수 인덱스를 활용 (첫 번째 인덱스가 가장 오래된 값)
- `ZREMRANGEBYRANK`로 범위 지정 삭제

**예시:**
```redis
# 유저 123의 최신 데이터 5개만 유지하고 나머지 삭제
# 6번째 이전의 모든 데이터 삭제 (-6부터 음수 끝까지)
ZREMRANGEBYRANK search:123 0 -6
```