---
aliases:
  - 레디스_랭킹
tags:
  - 리더보드
  - 랭킹
  - sortedset
  - score
  - ranking
  - 실시간랭킹
---
## Sorted Set을 이용한 리더보드

리더보드란 경쟁자들의 순위와 현재 점수를 보여주는 순위표입니다.

Sorted Set은 점수별로 자동 정렬되기 때문에 리더보드 구현에 최적화되어 있습니다.

### 리더보드 유형
- **절대적 리더보드**: 모든 유저를 정렬시켜 상위권 목록만 표시
- **상대적 리더보드**: 유저와 인접해 있는 경쟁자 목록만 표시

### Sorted Set을 이용하는 방식

#### 1. 랭킹 생성 및 추가
- Key 값을 `daily-score:날짜` 형식으로 명명
- Score에는 점수, Member에는 유저 ID를 입력
```redis
ZADD daily-score:20251103 1 player:1
```

#### 2. 랭킹 조회
- `ZRANGE`를 이용하여 조회 가능
- 기본적으로 오름차순이므로 `REV` 옵션을 사용하여 내림차순 정렬
```redis
ZRANGE daily-score:20251103 0 -1 WITHSCORES REV
```

#### 3. 점수 업데이트
- `ZINCRBY`를 이용하여 member의 점수를 증감
- 점수 추가 시 자동으로 재정렬됨
```redis
ZINCRBY daily-score:20251103 100 player:1  # 100점 추가
```

#### 4. 랭킹 합산
- 주간/월간/년간 스코어를 합산하여 누적 랭킹 구현
- `ZUNIONSTORE` 커맨드를 사용하여 여러 키의 점수를 합산
```redis
ZUNIONSTORE weekly-score 3 daily-score:20251101 daily-score:20251102 daily-score:20251103
```

- 합산 시 스코어에 가중치 적용 가능
- `WEIGHTS` 옵션으로 각 키에 대한 가중치 비율 설정
```redis
ZUNIONSTORE weekly-score 3 daily-score:20251101 daily-score:20251102 daily-score:20251103 WEIGHTS 1 1.5 2
```